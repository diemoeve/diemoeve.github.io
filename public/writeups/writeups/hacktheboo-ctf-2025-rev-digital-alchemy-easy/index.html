<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>HackTheBoo CTF 2025 | Rev: Digital Alchemy [easy] - moeve&#39;s blog</title><link rel="icon" type="image/x-icon" href="/favicon2.8f68632c487952c29fd770f908f1910c2adc7ffbb78ffd0c71771bca8c5b71e1.ico" /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Reverse-engineering an ELF to transmute lead into a flag using a two-stage transform and an LCG-driven nibble XOR." />
	<meta property="og:image" content=""/>
	<script>
	(function () {
		var storageKey = 'theme';
		var classList = document.documentElement.classList;
		var storedTheme = null;
		try {
			storedTheme = window.localStorage.getItem(storageKey);
		} catch (err) {
			storedTheme = null;
		}
		var prefersDark = false;
		try {
			prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
		} catch (err) {
			prefersDark = false;
		}
		var theme = (storedTheme === 'dark' || storedTheme === 'light') ? storedTheme : (prefersDark ? 'dark' : 'light');
		if (theme === 'dark') {
			classList.add('dark');
		} else {
			classList.remove('dark');
		}
	})();
	</script>
	<script type="module" src="https://diemoeve.github.io/js/theme-toggle.js" defer></script>
	<meta property="og:url" content="https://diemoeve.github.io/writeups/writeups/hacktheboo-ctf-2025-rev-digital-alchemy-easy/">
  <meta property="og:site_name" content="moeve&#39;s blog">
  <meta property="og:title" content="HackTheBoo CTF 2025 | Rev: Digital Alchemy [easy]">
  <meta property="og:description" content="Reverse-engineering an ELF to transmute lead into a flag using a two-stage transform and an LCG-driven nibble XOR.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2025-10-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-27T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="HackTheBoo 2025">
    <meta property="article:tag" content="Reverse Engineering">
    <meta property="article:tag" content="ELF">
    <meta property="article:tag" content="X86_64">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="HackTheBoo CTF 2025 | Rev: Digital Alchemy [easy]">
  <meta name="twitter:description" content="Reverse-engineering an ELF to transmute lead into a flag using a two-stage transform and an LCG-driven nibble XOR.">

        <link href="https://diemoeve.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://diemoeve.github.io/css/main.7a5c05040394322612a2d98397e9932aa81d9d7acc70199463e79f8180c8e0c0.css" />
		
		
		<link rel="stylesheet" type="text/css" href="https://diemoeve.github.io/css/custom.07f912777db42e88a413bca7f38a722b56303b2914ca91d86ae3341cccc44ed5.css">
		
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://diemoeve.github.io/">moeve&#39;s blog</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/writeups/">Writeups</a>
		
		<a href="/tags/">Tags</a>
		
		<button id="theme-toggle" class="theme-toggle" type="button" aria-label="Switch to dark mode" aria-pressed="false">
			<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
			</svg>
			<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<circle cx="12" cy="12" r="5"></circle>
				<line x1="12" y1="1" x2="12" y2="3"></line>
				<line x1="12" y1="21" x2="12" y2="23"></line>
				<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
				<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
				<line x1="1" y1="12" x2="3" y2="12"></line>
				<line x1="21" y1="12" x2="23" y2="12"></line>
				<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
				<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
			</svg>
		</button>
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">HackTheBoo CTF 2025 | Rev: Digital Alchemy [easy]</h1>
          <div class="meta">Posted on Oct 27, 2025</div>
        </div>
        
        <section class="body">
          <p>Morvidus the alchemist claims to have perfected the art of digital alchemy. Being paranoid, he secured his incantation with a complex algorithm, but left the code rushed and broken. Fix his amateur mistakes and claim the digital gold for yourself!</p>
<h2 id="step-1-explore-the-challenge-files">Step 1: Explore the Challenge Files</h2>
<p>List the contents and identify file types.</p>
<pre tabindex="0"><code>ls -l
file athanor
cat lead.txt
xxd lead.txt
</code></pre><p>Findings:</p>
<ul>
<li><code>athanor</code>: 64-bit PIE ELF, stripped.</li>
<li><code>lead.txt</code>: begins with magic <code>MTRLLEAD</code>, then 4 bytes, then a payload.</li>
</ul>
<p>Header breakdown (from <code>xxd</code>):</p>
<pre tabindex="0"><code>00000000: 4d54 524c 4c45 4144 972c ffbc ...  MTRLLEAD.,..
</code></pre><ul>
<li>Magic: <code>MTRLLEAD</code></li>
<li>Seed (big-endian): <code>0x97 0x2c 0xff 0xbc</code> → <code>0x972cffbc</code></li>
</ul>
<h2 id="step-2-baseline-runtime-behavior">Step 2: Baseline Runtime Behavior</h2>
<p>Run the binary to observe side effects.</p>
<pre tabindex="0"><code>./athanor
ls -l
cat gold.txt
</code></pre><p>Output snippet:</p>
<pre tabindex="0"><code>Initializing the Athanor...
The Athanor glows brightly, revealing a secret...
</code></pre><p>The program writes <code>gold.txt</code> with 7 bytes: <code>J^Mw_~&lt;</code>.</p>
<h2 id="step-3-static-recon-of-the-binary">Step 3: Static Recon of the Binary</h2>
<p>Pull strings and inspect <code>.rodata</code>.</p>
<pre tabindex="0"><code>strings -a athanor | head -n 50
objdump -s -j .rodata athanor
</code></pre><p>Interesting data in <code>.rodata</code>:</p>
<ul>
<li><code>USMWO[]\iN[QWRYdqXle[i_bm^aoc</code> (29 bytes)</li>
<li>Filenames: <code>lead.txt</code>, <code>gold.txt</code></li>
<li>Messages, and the magic <code>MTRLLEAD</code></li>
</ul>
<p>Disassemble to locate the main logic.</p>
<pre tabindex="0"><code>objdump -M intel -d athanor | sed -n &#39;300,420p&#39;
</code></pre><p>Key observations (addresses approximate):</p>
<ul>
<li>0x1251–0x1310: reads <code>lead.txt</code>, checks header, loads 4-byte seed big-endian.</li>
<li>0x13bb–0x148f: Stage 1 loop processes 29 bytes, accumulates a signed sum, and reconstructs the 29-byte key above (verification path via <code>strcmp</code>).</li>
<li>0x14d4–0x15c5: Stage 2 allocates a 0x28 buffer, copies 7 bytes from the remaining payload, then for each byte computes: <code>state = (0x214f*state + sum) mod 0x26688d; out[i] = in[i] ^ (state &amp; 0xf)</code> and writes 7 bytes to <code>gold.txt</code>.</li>
</ul>
<p>Attempts to use tracing were sandbox-blocked, so analysis stayed static:</p>
<pre tabindex="0"><code>gdb -q ./athanor      # no symbols; ptrace blocked here
strace -s 80 ./athanor # ptrace blocked in sandbox
</code></pre><h2 id="overview-diagram">Overview Diagram</h2>
<p>High-level flow of the transformation:</p>
<pre tabindex="0"><code>+---------------------+           +-----------------------------+
| lead.txt            |           | athanor (ELF, stripped)     |
|  MTRLLEAD | seed    |  -----&gt;   |  read header + seed (BE)    |
|  payload            |           |  stage1: consume 29 bytes   |
|                     |           |    - derive 29B key         |
+---------------------+           |    - signed sum S of bytes  |
                                  |  stage2: for remaining tail |
                                  |    state = (0x214F*state+S) |
                                  |            mod 0x26688D     |
                                  |    out[i] = in[i] ^ (state  |
                                  |                 &amp; 0xF)      |
                                  +-------------+---------------+
                                                |
                                                v
                                              (flag)
</code></pre><h2 id="step-4-model-the-transform-in-python">Step 4: Model the Transform in Python</h2>
<p>Recreate Stage 1 to confirm the embedded 29-byte key and compute the signed sum of the first 29 payload bytes (result: 2245).</p>
<pre tabindex="0"><code>from pathlib import Path
data = Path(&#39;lead.txt&#39;).read_bytes()
payload = bytearray(data[12:])
base = 0x40
key_len = 29
signed_sum = 0
idx = 0
for i in range(key_len):
    b = payload[idx]; idx += 1
    signed_sum += b if b &lt; 0x80 else b - 0x100
    # complex per-byte transform (matches key in .rodata)
    t = base ^ ((base + i + b) &amp; 0xff)
    h = ((t*3) &gt;&gt; 8) &amp; 0xff
    t2 = (((t - h) &amp; 0xff) &gt;&gt; 1) &amp; 0xff
    t2 = (t2 + h) &amp; 0xff
    t2 = (t2 &gt;&gt; 6) &amp; 0xff
    t3 = ((t2 &lt;&lt; 7) - t2) &amp; 0xff
    out = (t - t3 + 1) &amp; 0xff
print(&#39;sum =&#39;, signed_sum)
print(&#39;stage1 consumed =&#39;, idx)
</code></pre><p>Stage 2 on the next 7 bytes reproduces <code>gold.txt</code> but we can also apply it to the entire remaining payload to get the flag.</p>
<pre tabindex="0"><code>from pathlib import Path
data = Path(&#39;lead.txt&#39;).read_bytes()
seed = int.from_bytes(data[8:12], &#39;big&#39;)
payload = bytearray(data[12:])
base, key_len = 0x40, 29
signed_sum = sum((b if b &lt; 0x80 else b-0x100) for b in payload[:key_len])
tail = payload[key_len:]
state = seed
res = bytearray()
for b in tail:
    state = (0x214f*state + (signed_sum &amp; 0xffffffff)) &amp; 0xffffffff
    state %= 0x26688d
    res.append(b ^ (state &amp; 0xf))
print(res.decode(&#39;latin1&#39;))
</code></pre><p>Output:</p>
<pre tabindex="0"><code>HTB{Sp1r1t_0f_Th3_C0d3_Aw4k3n3d}\x0c
</code></pre><ul>
<li>strip the <code>\x0c</code></li>
</ul>

        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/hackthebox">HackTheBox</a></li>
              
              <li><a href="/tags/hacktheboo-2025">HackTheBoo 2025</a></li>
              
              <li><a href="/tags/reverse-engineering">Reverse Engineering</a></li>
              
              <li><a href="/tags/elf">ELF</a></li>
              
              <li><a href="/tags/x86_64">x86_64</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    © 2025 moeve · Theme based on <a href="https://github.com/athul/archie">Archie</a> (MIT)
  </div>
</footer>



</div>
    </body>
</html>
