<!DOCTYPE html>
<html><head lang="en"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>HackTheBoo CTF 2025 | Crypto: Leaking for Answers [easy] - moeve&#39;s blog</title><link rel="icon" type="image/x-icon" href="/favicon2.8f68632c487952c29fd770f908f1910c2adc7ffbb78ffd0c71771bca8c5b71e1.ico" /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Automating four RSA mini-challenges exposed through different leaks to recover the flag from a remote oracle." />
	<meta property="og:image" content=""/>
	<script>
	(function () {
		var storageKey = 'theme';
		var classList = document.documentElement.classList;
		var storedTheme = null;
		try {
			storedTheme = window.localStorage.getItem(storageKey);
		} catch (err) {
			storedTheme = null;
		}
		var prefersDark = false;
		try {
			prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
		} catch (err) {
			prefersDark = false;
		}
		var theme = (storedTheme === 'dark' || storedTheme === 'light') ? storedTheme : (prefersDark ? 'dark' : 'light');
		if (theme === 'dark') {
			classList.add('dark');
		} else {
			classList.remove('dark');
		}
	})();
	</script>
	<script type="module" src="http://localhost:1313/js/theme-toggle.js" defer></script>
	<meta property="og:url" content="http://localhost:1313/writeups/writeups/hacktheboo-ctf-2025-crypto-leaking-for-answers-easy/">
  <meta property="og:site_name" content="moeve&#39;s blog">
  <meta property="og:title" content="HackTheBoo CTF 2025 | Crypto: Leaking for Answers [easy]">
  <meta property="og:description" content="Automating four RSA mini-challenges exposed through different leaks to recover the flag from a remote oracle.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writeups">
    <meta property="article:published_time" content="2025-10-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-10-27T00:00:00+00:00">
    <meta property="article:tag" content="HackTheBox">
    <meta property="article:tag" content="HackTheBoo 2025">
    <meta property="article:tag" content="Cryptography">
    <meta property="article:tag" content="RSA">
    <meta property="article:tag" content="Python">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="HackTheBoo CTF 2025 | Crypto: Leaking for Answers [easy]">
  <meta name="twitter:description" content="Automating four RSA mini-challenges exposed through different leaks to recover the flag from a remote oracle.">

        <link href="http://localhost:1313/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/main.7a5c05040394322612a2d98397e9932aa81d9d7acc70199463e79f8180c8e0c0.css" />
		
		
		<link rel="stylesheet" type="text/css" href="http://localhost:1313/css/custom.07f912777db42e88a413bca7f38a722b56303b2914ca91d86ae3341cccc44ed5.css">
		
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="http://localhost:1313/">moeve&#39;s blog</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/writeups/">Writeups</a>
		
		<a href="/tags/">Tags</a>
		
		<button id="theme-toggle" class="theme-toggle" type="button" aria-label="Switch to dark mode" aria-pressed="false">
			<svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
			</svg>
			<svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
				<circle cx="12" cy="12" r="5"></circle>
				<line x1="12" y1="1" x2="12" y2="3"></line>
				<line x1="12" y1="21" x2="12" y2="23"></line>
				<line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
				<line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
				<line x1="1" y1="12" x2="3" y2="12"></line>
				<line x1="21" y1="12" x2="23" y2="12"></line>
				<line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
				<line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
			</svg>
		</button>
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">HackTheBoo CTF 2025 | Crypto: Leaking for Answers [easy]</h1>
          <div class="meta">Posted on Oct 27, 2025</div>
        </div>
        
        <section class="body">
          <p>Willem&rsquo;s path led him to a lone reed-keeper on the marsh bank. The keeper speaks only in riddles and will reveal nothing for free - yet he offers tests, one for each secret he guards. Each riddle is a vetting: answer each in turn, and the keeper will whisper what the fen keeps hidden. Fail, or linger too long answering the questions, and the marsh swallows the night. This is a sourceless riddle stand - connect, answer each of the keeper&rsquo;s four puzzles in sequence, and the final secret will be yours.</p>
<h2 id="step-1-talk-to-the-keeper">Step 1: Talk to the Keeper</h2>
<p>First, try to connect.</p>
<pre tabindex="0"><code>nc 68.183.73.240 31521
</code></pre><p>Output snippet:</p>
<pre tabindex="0"><code>The keeper croaks once and waits...
n = 2386...
p-q = 2684...
[1] Speak the pair of primes as (p,q) :
</code></pre><p>The service expects prime factors of <code>n</code>. Rerunning would cycle through four distinct challenge types, we need an automated solver.</p>
<h2 id="step-2-catalogue-the-leak-types">Step 2: Catalogue the Leak Types</h2>
<p>Interacting manually revealed four RSA variants:</p>
<ol>
<li>
<p><strong>Known difference:</strong> <code>p−q = diff</code>. Standard quadratic solution: <code>root = sqrt(diff^2 + 4n)</code>, <code>p = (diff + root)/2</code>, <code>q = p − diff</code>.</p>
</li>
<li>
<p><strong>φ inverse leak:</strong> The prompt showed <code>pow(phi, -1, n) * d % n = leak</code> along with <code>e</code>. Rearranged from <code>ed − kφ = 1</code>, we brute-forced small <code>k</code> to recover <code>φ</code>, then solved for <code>p</code> and <code>q</code> if the reconstruction was consistent.</p>
</li>
<li>
<p><strong>Private exponent leak:</strong> <code>k = ed − 1</code> factorisation with repeated attempts of the Boneh–Durfee style loop (random <code>g</code>, square repeatedly, check gcd when squaring hits 1) until a non-trivial factor.</p>
</li>
<li>
<p><strong>Inverse pair leak:</strong> The keeper leaked <code>A = pow(p, -q, q)</code> and <code>B = pow(q, -p, p)</code>. From <code>A·p ≡ 1 (mod q)</code> and <code>B·q ≡ 1 (mod p)</code> we arrive at <code>A·p + B·q ≡ 1 (mod n)</code> and in practice <code>A·p + B·q = n + 1</code>. Substituting into a quadratic yields the discriminant <code>Δ = (n + 1)^2 − 4ABn</code>, so</p>
<pre tabindex="0"><code>root = isqrt(Δ)
p = ((n + 1) ± root) / (2A)
q = n / p
</code></pre></li>
</ol>
<p>Each scenario needs its own function and a safety net (Fermat, Pollard’s rho, small trial division).</p>
<h2 id="step-3-building-the-script">Step 3: Building the script</h2>
<p>You could use<code>gmpy2</code>, but I used python’s <code>math.isqrt</code>.</p>
<pre tabindex="0"><code>import random
import re
import socket
from math import gcd, isqrt

HOST, PORT = &#34;68.183.73.240&#34;, 31521

inv = lambda a, m: pow(a, -1, m)

def pq(n, diff):
    r = isqrt(diff * diff + 4 * n)
    p = (diff + r) // 2
    return p, n // p

def phi_leak(n, e, leak):
    for k in range(1, 200000):
        x = (e * leak - k) % n
        if x and gcd(x, n) == 1:
            phi = inv(x, n)
            s = n - phi + 1
            d = s * s - 4 * n
            r = isqrt(d)
            if r * r == d:
                p = (s + r) // 2
                return p, n // p

def d_leak(n, e, d):
    k = e * d - 1
    s = 0
    while k % 2 == 0:
        k //= 2
        s += 1
    for _ in range(64):
        g = random.randrange(2, n - 1)
        x = pow(g, k, n)
        if x in (1, n - 1):
            continue
        for _ in range(s):
            y = pow(x, 2, n)
            if y == 1:
                p = gcd(x - 1, n)
                return p, n // p
            if y == n - 1:
                break
            x = y

def inv_leak(n, a, b):
    d = (n + 1) * (n + 1) - 4 * a * b * n
    r = isqrt(d)
    for sign in (1, -1):
        num = (n + 1) + sign * r
        den = 2 * a
        if den and num % den == 0:
            p = num // den
            if p &gt; 1:
                return p, n // p

def fermat(n, iters=200000):
    a = isqrt(n)
    if a * a &lt; n:
        a += 1
    for _ in range(iters):
        b2 = a * a - n
        b = isqrt(b2)
        if b * b == b2:
            return a + b, a - b
        a += 1

def read_prompt(sock):
    buf = b&#34;&#34;
    while True:
        chunk = sock.recv(4096)
        if not chunk:
            break
        buf += chunk
        low = buf.lower()
        if b&#34;htb{&#34; in buf:
            break
        if b&#34;speak&#34; in low or b&#34;(p,q&#34; in low:
            break
    return buf.decode()


def solve(text):
    n = int(re.search(r&#34;n\s*=\s*(\d+)&#34;, text).group(1))
    if &#34;p-q&#34; in text:
        diff = int(re.search(r&#34;p-q\s*=\s*(-?\d+)&#34;, text).group(1))
        return pq(n, diff)
    if &#34;pow(phi&#34; in text:
        e = int(re.search(r&#34;e\s*=\s*(\d+)&#34;, text).group(1))
        leak = int(re.search(r&#34;pow\(phi.*?=\s*(\d+)&#34;, text).group(1))
        return phi_leak(n, e, leak)
    if &#34;d =&#34; in text:
        e = int(re.search(r&#34;e\s*=\s*(\d+)&#34;, text).group(1))
        d = int(re.search(r&#34;d\s*=\s*(\d+)&#34;, text).group(1))
        return d_leak(n, e, d)
    if &#34;pow(p, -q&#34; in text:
        a = int(re.search(r&#34;pow\(p, -q, q\)\s*=\s*(\d+)&#34;, text).group(1))
        b = int(re.search(r&#34;pow\(q, -p, p\)\s*=\s*(\d+)&#34;, text).group(1))
        return inv_leak(n, a, b)
    return fermat(n)

with socket.create_connection((HOST, PORT)) as s:
    for _ in range(8):
        data = read_prompt(s)
        print(data)
        if &#34;HTB{&#34; in data:
            break
        p, q = solve(data)
        s.sendall(f&#34;{p},{q}\n&#34;.encode())
</code></pre><p>The main loop opened the socket, read until the <code>Speak the pair of primes</code> prompt, dispatched to the right solver, sanity-checked <code>p*q == n</code>, and sent the answer. Extra guards retried or fell back to <code>2,2</code> if something unexpected happened.</p>
<h2 id="step-4-flag">Step 4: Flag</h2>
<p>Running the script solved all four rounds back-to-back and triggered the finale.</p>
<pre tabindex="0"><code>python3 exploit.py
</code></pre><p>Output snippet:</p>
<pre tabindex="0"><code>pow(q, -p, p) = 42852827395689524086438949641477969773433092939989784749451440029892365430882527966362537470683299500634711589188279805815655104612810439303734046609232546763988778418954454646538252634253701418351175018232172091283445825517370993661469015333257282066358762311684136680072293208143191687024832878888343744051
[4] Speak the pair of primes as (p,q) : 
The keeper bows. You have answered all his tests.
HTB{t0_l34k___0r_n0t___t0_l34k_f0r_4nsw3rs_0af9ea5217203e9f59e7a04b75191755}
</code></pre>
        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/hackthebox">HackTheBox</a></li>
              
              <li><a href="/tags/hacktheboo-2025">HackTheBoo 2025</a></li>
              
              <li><a href="/tags/cryptography">Cryptography</a></li>
              
              <li><a href="/tags/rsa">RSA</a></li>
              
              <li><a href="/tags/python">Python</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"></div>
  <div class="footer-info">
    © 2025 moeve · Theme based on <a href="https://github.com/athul/archie">Archie</a> (MIT)
  </div>
</footer>

</div>
    </body>
</html>
